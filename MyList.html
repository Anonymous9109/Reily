<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>My List</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background-color: black;
    color: white;
  }
  h2 {
    margin-bottom: 20px;
  }
  #watchLaterList {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding: 10px;
    scrollbar-width: thin;
    scrollbar-color: #ccc transparent;
  }
  #watchLaterList::-webkit-scrollbar {
    height: 0px;
  }
  .video-container img {
    width: 110px;
    height: 160px;
    border-radius: 5px;
    cursor: pointer;
    object-fit: cover;
  }
</style>
</head>
<body>

<h2>My List</h2>
<div id="watchLaterList"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCExki28m1NNepVQEIjmcQzR8z8O68LqIc",
    authDomain: "rinolski-notifications.firebaseapp.com",
    databaseURL: "https://rinolski-notifications-default-rtdb.firebaseio.com",
    projectId: "rinolski-notifications",
    storageBucket: "rinolski-notifications.appspot.com",
    messagingSenderId: "355554579853",
    appId: "1:355554579853:web:3caa961653c0cdc0a359c4",
    measurementId: "G-WZ84970GST"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const auth = getAuth();

  const watchLaterList = document.getElementById("watchLaterList");

  onAuthStateChanged(auth, (user) => {
    if (!user) {
      watchLaterList.innerHTML = "<p>Please sign in to view your list.</p>";
      return;
    }

    const username = user.email.replace("@gmail.com", "");
    const userRef = ref(database, `watchLater/${username}`);

    onValue(userRef, (snapshot) => {
      watchLaterList.innerHTML = ""; // Clear old list
      const data = snapshot.val();

      if (!data) {
        watchLaterList.innerHTML = "<p>Your list is empty.</p>";
        return;
      }

      // Convert data to array and sort by timestamp DESC
      const videos = Object.values(data).sort((a, b) => b.timestamp - a.timestamp);

      videos.forEach(video => {
        const videoDiv = document.createElement("div");
        videoDiv.classList.add("video-container");
        videoDiv.innerHTML = `
          <a href="${video.link}" target="_top" rel="noopener noreferrer">
            <img src="${video.thumbnail}" alt="Video Thumbnail" />
          </a>
        `;
        watchLaterList.appendChild(videoDiv);
      });
    });
  });
</script>

</body>
</html>